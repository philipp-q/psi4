#! MBIS calculation on NaCl
#Charges generated from e_convergence 9, d_convergence 8

charges_ref = psi4.Matrix.from_list([ #TEST
 [ 0.96523585],   #TEST
 [-0.96523183]])  #TEST

dipoles_ref = psi4.Matrix.from_list([ #TEST
 [-2.23411999e-14, -2.20439206e-15, -9.80619005e-03],   #TEST
 [-1.75989793e-14, -2.48615076e-14,  6.42357434e-01]])  #TEST

quadrupoles_ref = psi4.Matrix.from_list([ #TEST
 [-2.34992472e+00,  7.61625032e-15,  1.11488363e-14, -2.34992472e+00,
   1.52174839e-14, -2.28980795e+00],      #TEST
 [-1.18919799e+01, -8.95107296e-15,  4.38636176e-14, -1.18919799e+01,
  -1.25080726e-15, -1.20798224e+01]])     #TEST

octupoles_ref = psi4.Matrix.from_list([ #TEST
 [-7.08856182e-13,  9.00611501e-14, -2.55766638e-02, -8.21613343e-14,
   4.11929052e-15, -8.64722183e-14, -2.92947446e-15, -2.55766638e-02,
   2.96871792e-14, -5.92204894e-02],    #TEST
 [-1.02278453e-13, -3.95370047e-14,  2.25695766e+00, -2.19172973e-14,
   5.53616140e-14, -1.58857644e-13, -3.37545507e-13,  2.25695766e+00,
   5.64299708e-14,  4.56953404e+00]])   #TEST

molecule mol {
  0 1
  Na 0.00 0.00 0.00
  Cl 0.00 0.00 2.36
  symmetry c1
  no_reorient
  no_com
}

set {
  scf_type df
  d_convergence 8
  e_convergence 9
  mbis_radial_points 99
  mbis_spherical_points 350
}

e, wfn = energy('hf/cc-pvdz', return_wfn=True)
oeprop(wfn, 'MBIS_CHARGES', title='NaCl SCF')

#NOTE: wfn.array_variable gives you flattened atomic multipole arrays; for expanded arrays, use wfn.variable
charges = wfn.array_variable('MBIS CHARGES')
dipoles = wfn.array_variable('MBIS DIPOLES')
quadrupoles = wfn.array_variable('MBIS QUADRUPOLES')
octupoles = wfn.array_variable('MBIS OCTUPOLES')

compare_matrices(charges_ref, charges, 5, "MBIS Charges")             #TEST
compare_matrices(dipoles_ref, dipoles, 5, "MBIS Dipoles")             #TEST
compare_matrices(quadrupoles_ref, quadrupoles, 5, "MBIS Quadrupoles") #TEST
compare_matrices(octupoles_ref, octupoles, 5, "MBIS Octupoles")       #TEST
